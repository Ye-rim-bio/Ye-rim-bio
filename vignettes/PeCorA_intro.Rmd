---
title: "PeCorA"
output:
  html_document:
    highlight: tango
---

<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{PeCorA}
%\VignetteKeyword{MSnSet.utils}
%\VignettePackage{MSnSet.utils}
-->

<!--
```{r setup, echo=FALSE, results='hide'}
# set global chunk options
library("knitr")
opts_chunk$set(size='tiny')
```
-->


```{r env, message=FALSE, echo=FALSE, cache=FALSE, warning=FALSE}
library(MSnSet.utils)
library(dplyr)
library(tidyr)

## Load an msnset here which includes a "Protein" column in fData.
data("PeCorA_msnset")
```


Running pecora_analysis requires an msnset with a `Protein` column in fData. A treatment variable contained in
pData, and a character of proteins to analyze with PeCorA must also be given. Finally, the value of
`median_mod` can be set to `TRUE` and PeCorA will aggregate all other peptides using the median, 
lowering the degrees of freedom in the linear model to a more accurate number, as peptides mapping 
to the same protein are not independent observations. By default the value is `FALSE`, which matches
the original PeCorA.

```{r}
m <- pecora_analysis(m, "gpath_quantile", c("APOE", "BIN1"))

## The result is stored in fData.
#View(fData(m))

```


Running PeCorA again will add new results to fData.

```{r}
m <- pecora_analysis(m, "gpath", c("APOE", "BIN1"), median_mod = FALSE)

## The result is stored in fData.
# View(fData(m))

## If an old result is found, it is overwritten.
m <- pecora_analysis(m, "gpath", c("APOE", "BIN1"), median_mod = TRUE)

```

Finally, pecora_plot can plot a particular feature (peptide) against all other peptides 
mapping to the same protein, appending the p_value from PeCorA to the plot. Depending on the type of
the treatment variable (character/factor vs numerical) a boxplot/scatter plot is made, respectively.

The parameter `median_mod` can be set to `TRUE` to aggregate (sample wise) all other peptides mapping
to the same protein using the median.


```{r}
pecora_plot(m, "LGADMEDVCGR", "gpath", median_mod = F)

```







